<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注专转  砖转 RM-CPA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; direction: rtl; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px 30px; margin-bottom: 20px; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #2c3e50; font-size: 2em; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .notification-bell { position: relative; cursor: pointer; font-size: 1.5em; color: #667eea; }
        .notification-count { position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7em; display: flex; align-items: center; justify-content: center; }
        .auth-container, .main-app { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); margin-bottom: 20px; }
        .hidden { display: none !important; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 10px; font-size: 16px; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.9); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; margin: 5px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: linear-gradient(45deg, #95a5a6, #34495e); }
        .btn-danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .btn-success { background: linear-gradient(45deg, #27ae60, #2ecc71); }
        .nav-tabs { display: flex; background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 5px; margin-bottom: 30px; }
        .nav-tab { flex: 1; padding: 15px; text-align: center; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; color: #2c3e50; font-weight: 600; }
        .nav-tab.active { background: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .task-form-container { background: rgba(255, 255, 255, 0.9); border-radius: 15px; padding: 30px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .task-list { background: rgba(255, 255, 255, 0.9); border-radius: 15px; padding: 20px; margin-top: 20px; }
        .task-item { background: white; border: 1px solid #e1e8ed; border-radius: 10px; padding: 20px; margin-bottom: 15px; transition: all 0.3s ease; }
        .task-item:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .task-title { font-weight: bold; color: #2c3e50; font-size: 1.2em; flex: 1; }
        .task-status { padding: 6px 12px; border-radius: 20px; font-size: 0.8em; font-weight: bold; white-space: nowrap; margin-right: 10px; }
        .status-not-started { background: #95a5a6; color: white; }
        .status-in-progress { background: #3498db; color: white; }
        .status-waiting-client { background: #f39c12; color: white; }
        .status-partner-review { background: #9b59b6; color: white; }
        .status-completed { background: #27ae60; color: white; }
        .task-details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .task-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .filters { background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .filters-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end; }
        .success-message, .error-message { padding: 10px 15px; border-radius: 10px; margin: 10px 0; text-align: center; }
        .success-message { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error-message { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(45deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)); padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); cursor: pointer; transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-number { font-size: 2em; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .autocomplete-container { position: relative; }
        .autocomplete-list { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e1e8ed; border-radius: 10px; max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .autocomplete-item { padding: 10px 15px; cursor: pointer; transition: background 0.2s; }
        .autocomplete-item:hover { background: #f8f9fa; }
        @media (max-width: 768px) { .container { padding: 10px; } .header { flex-direction: column; text-align: center; gap: 15px; } .header h1 { font-size: 1.5em; } .nav-tabs { flex-direction: column; } .dashboard-stats { grid-template-columns: 1fr; } .form-row { grid-template-columns: 1fr; } .task-header { flex-direction: column; align-items: flex-start; gap: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> 注专转  砖转 RM-CPA</h1>
            <div id="headerInfo" class="hidden">
                <div class="user-info">
                    <div>
                        <strong id="currentUserName"></strong>
                        <span id="currentUserRole"></span>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()">转转拽</button>
                </div>
            </div>
        </div>

        <!-- 住 转专转 -->
        <div id="authScreen" class="auth-container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">住 注专转</h2>
            <div class="form-group">
                <label>砖 砖转砖:</label>
                <input type="text" id="loginUsername" placeholder=" 砖 砖转砖" value="shmuel">
            </div>
            <div class="form-group">
                <label>拽 砖:</label>
                <input type="password" id="loginCode" placeholder=" 拽 砖" value="123456">
            </div>
            <button class="btn" onclick="login()">转专</button>
            <div id="authMessage"></div>
        </div>

        <!-- 住 注 -->
        <div id="employeeApp" class="main-app hidden">
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showEmployeeTab('create')">爪专转 砖</div>
                <div class="nav-tab" onclick="showEmployeeTab('my-tasks')">砖转 砖</div>
            </div>

            <div id="employeeCreateTab" class="tab-content">
                <div class="task-form-container">
                    <h3 style="margin-bottom: 25px; color: #2c3e50;">砖 砖</h3>
                    <form id="employeeTaskForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>转专转 砖:</label>
                                <input type="text" id="empTaskTitle" required placeholder="转专 拽爪专 转 砖">
                            </div>
                            <div class="form-group">
                                <label>拽:</label>
                                <div class="autocomplete-container">
                                    <input type="text" id="empTaskClient" required placeholder="转 拽 砖 拽..." oninput="filterClients(this.value, 'empClientList')">
                                    <div id="empClientList" class="autocomplete-list hidden"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>住 注:</label>
                                <select id="empTaskType" required>
                                    <option value="">专 住 注</option>
                                    <option value="annual-company"> 砖转 专</option>
                                    <option value="annual-personal"> 砖转 砖</option>
                                    <option value="estimate">砖注专</option>
                                    <option value="ongoing">驻 砖祝</option>
                                    <option value="fine-cancellation"> 拽住转</option>
                                    <option value="authority-contact">驻 专砖转</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>转专 注:</label>
                                <input type="date" id="empTaskDueDate" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>转专 砖:</label>
                            <textarea id="empTaskDescription" rows="4" placeholder="驻专 注 砖, 专砖转 转, 住 专砖 '"></textarea>
                        </div>

                        <div class="form-group">
                            <label>注专转 专砖转:</label>
                            <textarea id="empTaskNotes" rows="3" placeholder="注专转, 砖转  注 住祝"></textarea>
                        </div>

                        <button type="submit" class="btn btn-success">爪专 砖</button>
                        <button type="button" class="btn btn-secondary" onclick="clearEmployeeForm()">拽 驻住</button>
                    </form>
                </div>
            </div>

            <div id="employeeMyTasksTab" class="tab-content hidden">
                <div class="filters">
                    <h3 style="margin-bottom: 15px;">砖转 砖</h3>
                    <div class="filters-row">
                        <div class="form-group">
                            <label>驻砖:</label>
                            <input type="text" id="empSearchTasks" placeholder="驻砖 砖转..." oninput="filterEmployeeTasks()">
                        </div>
                        <div class="form-group">
                            <label>住住:</label>
                            <select id="empFilterStatus" onchange="filterEmployeeTasks()">
                                <option value=""> 住住</option>
                                <option value="not-started">专 转</option>
                                <option value="in-progress">注</option>
                                <option value="waiting-client"> 转 拽</option>
                                <option value="partner-review">注专 拽转 砖转祝</option>
                                <option value="completed">住转</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="task-list">
                    <div id="employeeTasksList"></div>
                </div>
            </div>
        </div>

        <!-- 住 砖转祝 -->
        <div id="partnerApp" class="main-app hidden">
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showPartnerTab('dashboard')">砖专</div>
                <div class="nav-tab" onclick="showPartnerTab('settings')">专转</div>
            </div>

            <div id="partnerDashboardTab" class="tab-content">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTasks">0</div>
                        <div>住" 砖转</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeTasks">0</div>
                        <div>砖转 驻注转</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedTasks">0</div>
                        <div>砖转 砖砖</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="overdueTasks">0</div>
                        <div>砖转 专</div>
                    </div>
                </div>

                <div class="filters">
                    <h3 style="margin-bottom: 15px;"> 砖转</h3>
                    <div class="filters-row">
                        <div class="form-group">
                            <label>驻砖:</label>
                            <input type="text" id="partnerSearchTasks" placeholder="驻砖 砖转..." oninput="filterPartnerTasks()">
                        </div>
                        <div class="form-group">
                            <label>注 驻:</label>
                            <select id="partnerFilterEmployee" onchange="filterPartnerTasks()">
                                <option value=""> 注</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>住住:</label>
                            <select id="partnerFilterStatus" onchange="filterPartnerTasks()">
                                <option value=""> 住住</option>
                                <option value="not-started">专 转</option>
                                <option value="in-progress">注</option>
                                <option value="waiting-client"> 转 拽</option>
                                <option value="partner-review">注专 拽转 砖转祝</option>
                                <option value="completed">住转</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="task-list">
                    <div id="partnerTasksList"></div>
                </div>
            </div>

            <div id="partnerSettingsTab" class="tab-content hidden">
                <h3>专转 注专转</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="addUser()">住祝 砖转砖</button>
                    <button class="btn btn-secondary" onclick="exportData()">爪 转</button>
                </div>
                <div id="usersList"></div>
            </div>
        </div>
    </div>

    <script>
        // 砖转 
        let currentUser = null;
        let users = [];
        let tasks = [];
        let clients = [];

        // 转 专砖
        function initializeData() {
            users = [
                { id: 1, username: 'shmuel', fullName: '砖', role: 'partner', email: 'shmuel@rm-cpa.co.il', code: '123456' }
            ];

            clients = [
                { id: 1, name: '专转 ABC 注"', contact: '住 ', phone: '050-1234567' },
                { id: 2, name: '砖专 XYZ 注"', contact: '砖专 ', phone: '052-9876543' },
                { id: 3, name: '注住拽 123 砖拽注转', contact: ' 专', phone: '054-5555555' }
            ];

            tasks = [];
        }

        // 转专转
        function login() {
            const username = document.getElementById('loginUsername').value;
            const code = document.getElementById('loginCode').value;
            
            if (!username || !code) {
                showMessage('authScreen', '  砖 砖转砖 拽 砖', 'error');
                return;
            }

            const user = users.find(u => u.username === username && u.code === code);
            
            if (user) {
                currentUser = user;
                showMainApp();
            } else {
                showMessage('authScreen', '砖 砖转砖  拽 砖 砖', 'error');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('employeeApp').classList.add('hidden');
            document.getElementById('partnerApp').classList.add('hidden');
            document.getElementById('headerInfo').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('headerInfo').classList.remove('hidden');
            
            document.getElementById('currentUserName').textContent = currentUser.fullName;
            document.getElementById('currentUserRole').textContent = `(${currentUser.role === 'partner' ? '砖转祝' : '注'})`;
            
            if (currentUser.role === 'employee') {
                document.getElementById('employeeApp').classList.remove('hidden');
                document.getElementById('partnerApp').classList.add('hidden');
                setTodayDate();
            } else {
                document.getElementById('partnerApp').classList.remove('hidden');
                document.getElementById('employeeApp').classList.add('hidden');
                updatePartnerStats();
                loadUsers();
            }
        }

        // 驻拽爪转 注
        function showEmployeeTab(tabName) {
            document.querySelectorAll('#employeeApp .tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('#employeeApp .nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (tabName === 'create') {
                document.getElementById('employeeCreateTab').classList.remove('hidden');
                event.target.classList.add('active');
            } else if (tabName === 'my-tasks') {
                document.getElementById('employeeMyTasksTab').classList.remove('hidden');
                event.target.classList.add('active');
                filterEmployeeTasks();
            }
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('empTaskDueDate').value = today;
        }

        document.getElementById('employeeTaskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const task = {
                id: Date.now(),
                title: document.getElementById('empTaskTitle').value,
                client: document.getElementById('empTaskClient').value,
                type: document.getElementById('empTaskType').value,
                dueDate: document.getElementById('empTaskDueDate').value,
                description: document.getElementById('empTaskDescription').value,
                notes: document.getElementById('empTaskNotes').value,
                status: 'not-started',
                assignedTo: currentUser.id,
                createdBy: currentUser.id,
                createdDate: new Date().toISOString()
            };

            tasks.push(task);
            clearEmployeeForm();
            showMessage('employeeCreateTab', '砖 爪专 爪!', 'success');
        });

        function clearEmployeeForm() {
            document.getElementById('employeeTaskForm').reset();
            setTodayDate();
        }

        function filterClients(searchTerm, listId) {
            const list = document.getElementById(listId);
            
            if (!searchTerm || searchTerm.length < 2) {
                list.classList.add('hidden');
                return;
            }
            
            const filteredClients = clients.filter(client => 
                client.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            list.innerHTML = '';
            
            filteredClients.forEach(client => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                item.textContent = client.name;
                item.onclick = () => {
                    document.getElementById('empTaskClient').value = client.name;
                    list.classList.add('hidden');
                };
                list.appendChild(item);
            });
            
            list.classList.remove('hidden');
        }

        function filterEmployeeTasks() {
            const myTasks = tasks.filter(task => task.assignedTo === currentUser.id);
            const searchTerm = document.getElementById('empSearchTasks').value.toLowerCase();
            const statusFilter = document.getElementById('empFilterStatus').value;
            
            let filteredTasks = myTasks;
            
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(searchTerm) ||
                    task.client.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            displayTasks(filteredTasks, 'employeeTasksList', 'employee');
        }

        // 驻拽爪转 砖转祝
        function showPartnerTab(tabName) {
            document.querySelectorAll('#partnerApp .tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('#partnerApp .nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (tabName === 'dashboard') {
                document.getElementById('partnerDashboardTab').classList.remove('hidden');
                event.target.classList.add('active');
                filterPartnerTasks();
            } else if (tabName === 'settings') {
                document.getElementById('partnerSettingsTab').classList.remove('hidden');
                event.target.classList.add('active');
            }
        }

        function updatePartnerStats() {
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('activeTasks').textContent = tasks.filter(t => t.status !== 'completed').length;
            document.getElementById('completedTasks').textContent = tasks.filter(t => t.status === 'completed').length;
            document.getElementById('overdueTasks').textContent = tasks.filter(t => 
                t.status !== 'completed' && new Date(t.dueDate) < new Date()
            ).length;
        }

        function filterPartnerTasks() {
            const searchTerm = document.getElementById('partnerSearchTasks').value.toLowerCase();
            const employeeFilter = document.getElementById('partnerFilterEmployee').value;
            const statusFilter = document.getElementById('partnerFilterStatus').value;
            
            let filteredTasks = [...tasks];
            
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(searchTerm) ||
                    task.client.toLowerCase().includes(searchTerm)
                );
            }
            
            if (employeeFilter) {
                filteredTasks = filteredTasks.filter(task => task.assignedTo == employeeFilter);
            }
            
            if (statusFilter) {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            displayTasks(filteredTasks, 'partnerTasksList', 'partner');
            
            // 注 住 注
            const select = document.getElementById('partnerFilterEmployee');
            select.innerHTML = '<option value=""> 注</option>';
            users.filter(u => u.role === 'employee').forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = emp.fullName;
                select.appendChild(option);
            });
        }

        function displayTasks(tasksToDisplay, containerId, userType) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (tasksToDisplay.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 40px;"> 砖转 爪</p>';
                return;
            }
            
            tasksToDisplay.forEach(task => {
                const assignedUser = users.find(u => u.id === task.assignedTo);
                const createdUser = users.find(u => u.id === task.createdBy);
                const isOverdue = task.status !== 'completed' && new Date(task.dueDate) < new Date();
                
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task-item';
                if (isOverdue) taskDiv.style.borderLeft = '4px solid #e74c3c';
                
                taskDiv.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title} ${isOverdue ? '锔' : ''}</div>
                        <div class="task-status status-${task.status}">${getStatusText(task.status)}</div>
                    </div>
                    <div class="task-details-grid">
                        <div><strong>拽:</strong> ${task.client}</div>
                        <div><strong>住 注:</strong> ${getTypeText(task.type)}</div>
                        <div><strong>转专 注:</strong> ${formatDate(task.dueDate)}</div>
                        ${userType === 'partner' ? `<div><strong>注 驻:</strong> ${assignedUser ? assignedUser.fullName : ' 注'}</div>` : ''}
                        <div>
                        <div><strong>爪专 注 :</strong> ${createdUser ? createdUser.fullName : ' 注'}</div>
                    </div>
                    ${task.description ? `<div style="margin-top: 10px;"><strong>转专:</strong> ${task.description}</div>` : ''}
                    ${task.notes ? `<div style="margin-top: 5px;"><strong>注专转:</strong> ${task.notes}</div>` : ''}
                    <div class="task-actions">
                        ${userType === 'employee' ? `
                            <button class="btn" onclick="updateTaskStatus(${task.id})">注 住住</button>
                        ` : `
                            <button class="btn" onclick="editTask(${task.id})">注专</button>
                            <button class="btn btn-danger" onclick="deleteTask(${task.id})">拽</button>
                        `}
                    </div>
                `;
                container.appendChild(taskDiv);
            });
        }

        function updateTaskStatus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const statuses = [
                { value: 'not-started', text: '专 转' },
                { value: 'in-progress', text: '注' },
                { value: 'waiting-client', text: ' 转 拽' },
                { value: 'partner-review', text: '注专 拽转 砖转祝' },
                { value: 'completed', text: '住转' }
            ];
            
            const newStatus = prompt(`专 住住 砖:\n\n` + 
                statuses.map((s, i) => `${i + 1}. ${s.text}`).join('\n') + 
                `\n\n 住驻专 (1-5):`);
            
            if (newStatus && newStatus >= 1 && newStatus <= 5) {
                task.status = statuses[newStatus - 1].value;
                filterEmployeeTasks();
                showMessage('employeeMyTasksTab', '住住 注 爪', 'success');
            }
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const newTitle = prompt('转专转 砖:', task.title);
            if (newTitle) {
                task.title = newTitle;
                filterPartnerTasks();
                updatePartnerStats();
                showMessage('partnerDashboardTab', '砖 注 爪', 'success');
            }
        }

        function deleteTask(taskId) {
            if (confirm(' 转  砖专爪 拽 转 砖?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                filterPartnerTasks();
                updatePartnerStats();
                showMessage('partnerDashboardTab', '砖 拽 爪', 'success');
            }
        }

        //  砖转砖
        function loadUsers() {
            const container = document.getElementById('usersList');
            container.innerHTML = '';
            
            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'task-item';
                userDiv.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${user.fullName}</div>
                        <div class="task-status ${user.role === 'partner' ? 'status-completed' : 'status-in-progress'}">
                            ${user.role === 'partner' ? '砖转祝' : '注'}
                        </div>
                    </div>
                    <div style="color: #7f8c8d; margin-bottom: 15px;">
                        <div><strong>砖 砖转砖:</strong> ${user.username}</div>
                        <div><strong>:</strong> ${user.email || ' 专'}</div>
                    </div>
                    <div class="task-actions">
                        <button class="btn" onclick="editUser(${user.id})">注专</button>
                        ${user.id !== currentUser.id ? `<button class="btn btn-danger" onclick="deleteUser(${user.id})">拽</button>` : ''}
                    </div>
                `;
                container.appendChild(userDiv);
            });
        }

        function addUser() {
            const fullName = prompt('砖 :');
            if (!fullName) return;
            
            const username = prompt('砖 砖转砖:');
            if (!username) return;
            
            const role = confirm('  砖转祝? ( = 注)') ? 'partner' : 'employee';
            const email = prompt(' (驻爪):') || '';
            const code = prompt('拽 砖:');
            if (!code) return;
            
            if (users.some(u => u.username === username)) {
                alert('砖 砖转砖 专 拽');
                return;
            }
            
            users.push({
                id: Date.now(),
                fullName,
                username,
                role,
                email,
                code
            });
            
            loadUsers();
            showMessage('partnerSettingsTab', '砖转砖 住祝 爪', 'success');
        }

        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const newName = prompt('砖 :', user.fullName);
            if (newName) {
                user.fullName = newName;
                loadUsers();
                showMessage('partnerSettingsTab', '砖转砖 注 爪', 'success');
            }
        }

        function deleteUser(userId) {
            if (confirm(' 转  砖专爪 拽 转 砖转砖?')) {
                users = users.filter(u => u.id !== userId);
                loadUsers();
                showMessage('partnerSettingsTab', '砖转砖 拽 爪', 'success');
            }
        }

        function exportData() {
            const data = { users, tasks, clients, exportDate: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 驻拽爪转 注专
        function getStatusText(status) {
            const statusTexts = {
                'not-started': '专 转',
                'in-progress': '注',
                'waiting-client': ' 转 拽',
                'partner-review': '注专 拽转 砖转祝',
                'completed': '住转'
            };
            return statusTexts[status] || status;
        }

        function getTypeText(type) {
            const typeTexts = {
                'annual-company': ' 砖转 专',
                'annual-personal': ' 砖转 砖',
                'estimate': '砖注专',
                'ongoing': '驻 砖祝',
                'fine-cancellation': ' 拽住转',
                'authority-contact': '驻 专砖转'
            };
            return typeTexts[type] || type;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('he-IL');
        }

        function showMessage(containerId, message, type) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }

        // 住专转 autocomplete
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-container')) {
                document.querySelectorAll('.autocomplete-list').forEach(list => {
                    list.classList.add('hidden');
                });
            }
        });

        // 转 注专转
        window.onload = function() {
            initializeData();
            
            // 转专转 转 砖转砖 砖
            currentUser = users.find(u => u.username === 'shmuel');
            if (currentUser) {
                showMainApp();
            }
        };

        // 砖专 转  30 砖转
        setInterval(() => {
            if (currentUser) {
                const data = { users, tasks, clients, lastSaved: new Date().toISOString() };
                localStorage.setItem('rmcpa-backup', JSON.stringify(data));
            }
        }, 30000);

        // 砖专 驻 住专转 
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                const data = { users, tasks, clients, lastSaved: new Date().toISOString() };
                localStorage.setItem('rmcpa-backup', JSON.stringify(data));
            }
        });

        // 注转 转 砖专 注转 驻注
        function loadSavedData() {
            const savedData = localStorage.getItem('rmcpa-backup');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.users) users = data.users;
                    if (data.tasks) tasks = data.tasks;
                    if (data.clients) clients = data.clients;
                    console.log('转 注  拽');
                } catch (error) {
                    console.error('砖 注转 转:', error);
                }
            }
        }

        // 拽专 注转 转 砖专
        loadSavedData();
    </script>
</body>
</html>
